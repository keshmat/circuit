---
import Layout from "../../layouts/Layout.astro";
import RegistrationsTable from "../../components/RegistrationsTable.astro";
---

<Layout title="Admin - Registrations">
  <main class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-4xl font-bold">Registrations</h1>
      <div class="flex gap-4">
        <button id="export-csv" class="btn btn-primary">Export CSV</button>
        <button id="refresh" class="btn btn-ghost">Refresh</button>
        <button id="logout" class="btn btn-ghost">Logout</button>
      </div>
    </div>

    <RegistrationsTable client:load />
  </main>
</Layout>

<script>
  import { supabase } from "../../db/supabase";

  // Handle logout
  document.getElementById("logout")?.addEventListener("click", async () => {
    try {
      const { error } = await supabase.auth.signOut();
      if (error) throw error;
      window.location.href = "/admin/login";
    } catch (error) {
      console.error("Error signing out:", error);
      const notification = document.createElement("div");
      notification.className = "toast toast-top toast-end";
      notification.innerHTML = `
        <div class="alert alert-error">
          <span>Error signing out</span>
        </div>
      `;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }
  });

  // Handle refresh
  document.getElementById("refresh")?.addEventListener("click", () => {
    window.location.reload();
  });
</script>
